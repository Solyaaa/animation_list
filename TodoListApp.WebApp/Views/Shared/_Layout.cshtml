@using Microsoft.AspNetCore.Mvc.TagHelpers

@functions {
    private object todo_listik_bot;
}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - TodoList</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .overdue { background: #ffe0e0; }
        .tag-badge { margin-right: .25rem; }
        .navbar-brand { font-weight: 700; letter-spacing: .3px; }
        
        /* Telegram мінімалістичні стилі */
        .telegram-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 30px 0;
            border: 1px solid #e3e6f0;
        }
        
        .telegram-title {
            color: #0088cc;
            font-weight: 600;
        }
        
        .qr-code {
            width: 150px;
            height: 150px;
            background: white;
            border: 2px solid #e3e6f0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .qr-code i {
            font-size: 60px;
            color: #0088cc;
        }
        
        .telegram-step {
            margin-bottom: 15px;
            padding-left: 20px;
            border-left: 3px solid #0088cc;
        }
        
        .telegram-step-number {
            background: #0088cc;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 10px;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg bg-body-tertiary border-bottom mb-3">
    <div class="container">
        <a class="navbar-brand" href="/Lists">
            <i class="fas fa-tasks me-2"></i>✅ TodoList
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div id="nav" class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" href="/Lists"><i class="fas fa-list me-1"></i> Мої списки</a></li>
                <li class="nav-item"><a class="nav-link" href="/Tags"><i class="fas fa-tags me-1"></i> Теги</a></li>
                <li class="nav-item"><a class="nav-link" href="/My/Assigned"><i class="fas fa-user-check me-1"></i> Призначені</a></li>
                <li class="nav-item"><a class="nav-link" href="/My/Search"><i class="fas fa-search me-1"></i> Пошук</a></li>
            </ul>
            <form class="d-flex" method="post" action="/Auth/Logout">
                <button class="btn btn-outline-danger btn-sm" type="submit"><i class="fas fa-sign-out-alt me-1"></i> Вийти</button>
            </form>
        </div>
    </div>
</nav>

<main class="container">
    @RenderBody()
    
    <!-- Telegram секція на головній -->
    @if (ViewContext.RouteData.Values["controller"]?.ToString() == "Lists" && 
         ViewContext.RouteData.Values["action"]?.ToString() == "Index")
    {
        <div class="telegram-section mt-5">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h5 class="telegram-title mb-3">
                        <i class="fab fa-telegram me-2"></i>Для зручності маємо Telegram бота
                    </h5>
                    <p class="mb-4">Керуйте завданнями прямо з месенджера. Скануйте QR-код, генеруйте API ключ та користуйтесь!</p>
                    
                    <div class="mb-4">
                        <h6 class="mb-3">Як почати:</h6>
                        <div class="telegram-step">
                            <span class="telegram-step-number">1</span>
                            <strong>Отримайте API ключ</strong>
                            <p class="small mb-0 text-muted">У розділі <a href="/ApiKeys" class="text-decoration-none">API Keys</a> створіть новий ключ</p>
                        </div>
                        <div class="telegram-step">
                            <span class="telegram-step-number">2</span>
                            <strong>Відскануйте QR-код</strong>
                            <p class="small mb-0 text-muted">Додайте бота до Telegram</p>
                        </div>
                        <div class="telegram-step">
                            <span class="telegram-step-number">3</span>
                            <strong>Зв'яжіть акаунт</strong>
                            <p class="small mb-0 text-muted">Надішліть боту команду: <code>/link ВАШ_API_КЛЮЧ</code></p>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <a href="/ApiKeys" class="btn btn-primary btn-sm">
                            <i class="fas fa-key me-1"></i> Отримати API ключ
                        </a>
                        <a href="#" class="btn btn-outline-secondary btn-sm" onclick="showBotCommands()">
                            <i class="fas fa-terminal me-1"></i> Команди бота
                        </a>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <div class="qr-code mb-3">
                        <i class="fab fa-telegram"></i>
                    </div>
                    <p class="small text-muted mb-2">Скануйте щоб додати бота</p>
                    <p class="small">
                        <i class="fas fa-robot me-1"></i>
                        <strong>@ViewBag.BotName</strong>
                    </p>
                </div>
            </div>
        </div>
    }
</main>

<!-- Модальне вікно з командами бота -->
<div class="modal fade" id="botCommandsModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fab fa-telegram me-2"></i>Команди Telegram бота
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <tbody>
                            <tr>
                                <td><code>/start</code></td>
                                <td>Початок роботи</td>
                            </tr>
                            <tr>
                                <td><code>/help</code></td>
                                <td>Допомога</td>
                            </tr>
                            <tr>
                                <td><code>/link API_KEY</code></td>
                                <td>Зв'язати акаунт</td>
                            </tr>
                            <tr>
                                <td><code>/tasks</code></td>
                                <td>Всі завдання</td>
                            </tr>
                            <tr>
                                <td><code>/tasks today</code></td>
                                <td>Завдання на сьогодні</td>
                            </tr>
                            <tr>
                                <td><code>/create Назва | Опис</code></td>
                                <td>Нове завдання</td>
                            </tr>
                            <tr>
                                <td><code>/remind #ID 15:30</code></td>
                                <td>Нагадування</td>
                            </tr>
                            <tr>
                                <td><code>/edit #ID title ...</code></td>
                                <td>Редагування</td>
                            </tr>
                            <tr>
                                <td><code>/complete #ID</code></td>
                                <td>Завершити</td>
                            </tr>
                            <tr>
                                <td><code>/lists</code></td>
                                <td>Списки</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Закрити</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Показати команди бота
    function showBotCommands() {
        var modal = new bootstrap.Modal(document.getElementById('botCommandsModal'));
        modal.show();
    }
    
    // Динамічно генеруємо QR код (можна додати реальну URL)
    document.addEventListener('DOMContentLoaded', function() {
        // Можна додати реальний QR код
        // var qrContainer = document.querySelector('.qr-code');
        // qrContainer.innerHTML = '<img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://t.me/your_bot" alt="Telegram Bot QR">';
        
        // Встановлюємо ім'я бота
        document.querySelectorAll('.telegram-section strong').forEach(el => {
            el.textContent = '@todo_listik_bot'; // Замініть на реальне ім'я
        });
    });
</script>
</body>
</html>